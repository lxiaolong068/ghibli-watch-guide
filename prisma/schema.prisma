// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Movie {
  id          String         @id @default(cuid())
  tmdbId      Int            @unique // Add unique TMDB ID
  titleEn     String         // English title
  titleJa     String         // Japanese title
  titleZh     String?        // Chinese title (optional)
  year        Int            // Release year
  director    String?        // Director (optional)
  duration    Int?           // Duration (minutes, optional)
  synopsis    String?        // Synopsis (optional)
  posterUrl   String?        // Poster URL (optional)
  backdropUrl String?        // Backdrop URL (optional)
  voteAverage Float?         // TMDB vote average (optional)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  // 关联电影可用性信息
  availabilities Availability[]
}

model Platform {
  id          String         @id @default(cuid())
  name        String         // Platform name
  website     String         // Platform website
  type        PlatformType   // Platform type
  logo        String?        // Platform logo URL (optional)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  // 平台与可用性的关联
  availabilities Availability[]
}

model Region {
  id          String         @id @default(cuid())
  code        String         @unique // Region code (e.g., US, JP, CN)
  name        String         // Region name
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  // 地区与可用性的关联
  availabilities Availability[]
}

// 新增Availability模型用于存储电影在不同地区和平台的可用性信息
model Availability {
  id          String         @id @default(cuid())
  url         String?        // 观看链接
  price       Float?         // 价格(如适用)
  currency    String?        // 货币单位(USD, CNY, JPY等)
  type        AvailabilityType // 可用性类型(流媒体、租赁等)
  lastChecked DateTime       // 最后检查时间
  isAvailable Boolean        @default(true) // 当前是否可用
  notes       String?        // 额外说明(如限时优惠等)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  // 关联关系
  movie       Movie          @relation(fields: [movieId], references: [id], onDelete: Cascade)
  movieId     String
  platform    Platform       @relation(fields: [platformId], references: [id], onDelete: Cascade)
  platformId  String
  region      Region         @relation(fields: [regionId], references: [id], onDelete: Cascade)
  regionId    String

  // 复合索引以加快查询速度
  @@index([movieId, regionId])
  @@index([platformId, regionId])
  @@unique([movieId, platformId, regionId, type])
}

enum PlatformType {
  STREAMING    // 流媒体
  RENTAL       // 租赁
  PURCHASE     // 购买
  FREE         // 免费
  CINEMA       // 电影院
  PHYSICAL     // 实体（如DVD）
}

// 新增枚举以表示可用性类型
enum AvailabilityType {
  SUBSCRIPTION // 订阅服务
  RENT         // 租赁
  BUY          // 购买
  FREE         // 免费
  CINEMA       // 电影院放映
  LIBRARY      // 图书馆借阅
  DVD          // DVD/蓝光光盘
}
