# 搜索功能测试指南

## 概述

本文档提供了吉卜力观影指南项目搜索功能的完整测试指南，包括功能测试、性能测试和用户体验测试。

## 自动化测试

### 运行测试

```bash
# 运行所有搜索相关测试
npm test search

# 运行特定测试文件
npm test __tests__/search.test.ts

# 运行测试并生成覆盖率报告
npm test -- --coverage
```

### 测试覆盖范围

- ✅ 搜索缓存功能
- ✅ 搜索历史管理
- ✅ 搜索高亮显示
- ✅ 相关性评分算法
- ✅ 性能测试
- ✅ 边界情况处理

## 手动测试

### 1. 基础搜索功能测试

#### 1.1 电影搜索
**测试步骤：**
1. 访问搜索页面 `/search`
2. 在搜索框中输入 "千与千寻"
3. 按回车或点击搜索按钮

**预期结果：**
- 显示相关的电影搜索结果
- 结果中包含标题、年份、导演等信息
- 搜索关键词被高亮显示
- 显示搜索结果数量

#### 1.2 多语言搜索
**测试用例：**
- 英文：`Spirited Away`
- 日文：`千と千尋の神隠し`
- 中文：`千与千寻`

**预期结果：**
- 所有语言都能找到相同的电影
- 搜索结果按相关性排序

#### 1.3 角色搜索
**测试步骤：**
1. 搜索 "千寻"
2. 检查搜索结果类型筛选
3. 选择 "角色" 类型

**预期结果：**
- 显示千寻角色信息
- 包含角色描述和相关电影
- 显示配音演员信息（如果有）

#### 1.4 导演搜索
**测试用例：**
- `宫崎骏`
- `Hayao Miyazaki`

**预期结果：**
- 显示该导演的所有作品
- 按相关性和年份排序

### 2. 高级搜索功能测试

#### 2.1 筛选功能
**测试步骤：**
1. 搜索 "宫崎骏"
2. 使用年份筛选：选择 "2000-2010"
3. 使用类型筛选：选择 "电影"

**预期结果：**
- 结果被正确筛选
- 筛选条件在URL中反映
- 可以清除筛选条件

#### 2.2 分页功能
**测试步骤：**
1. 搜索一个有很多结果的关键词
2. 检查分页控件
3. 点击下一页

**预期结果：**
- 分页控件正确显示
- 页面切换正常
- URL包含页码参数

#### 2.3 排序功能
**测试步骤：**
1. 搜索 "动画"
2. 检查结果排序（按相关性）
3. 观察相关性分数（开发模式下）

**预期结果：**
- 结果按相关性降序排列
- 完全匹配排在前面
- 部分匹配按匹配度排序

### 3. 搜索建议和自动完成测试

#### 3.1 实时搜索建议
**测试步骤：**
1. 在全局搜索框中输入 "千"
2. 等待搜索建议出现
3. 点击其中一个建议

**预期结果：**
- 建议在输入2个字符后出现
- 建议包含电影、角色、导演等
- 点击建议跳转到搜索结果

#### 3.2 搜索历史
**测试步骤：**
1. 进行几次搜索
2. 访问搜索页面（无查询参数）
3. 检查搜索历史部分

**预期结果：**
- 显示最近的搜索记录
- 可以点击历史记录重新搜索
- 可以删除单个历史记录
- 可以清除所有历史

#### 3.3 热门搜索
**测试步骤：**
1. 多次搜索相同关键词
2. 检查热门搜索标签
3. 验证搜索频率统计

**预期结果：**
- 频繁搜索的词出现在热门搜索中
- 按搜索频率排序
- 显示搜索次数

### 4. 搜索高亮和片段测试

#### 4.1 关键词高亮
**测试步骤：**
1. 搜索 "千寻 宫崎骏"
2. 检查搜索结果中的高亮

**预期结果：**
- 所有匹配的关键词都被高亮
- 高亮样式清晰可见
- 不同关键词可能有不同颜色

#### 4.2 搜索片段
**测试步骤：**
1. 搜索一个在长文本中出现的词
2. 检查描述片段

**预期结果：**
- 显示包含关键词的文本片段
- 片段长度适中（约200字符）
- 关键词在片段中被高亮

### 5. 性能测试

#### 5.1 搜索响应时间
**测试步骤：**
1. 打开浏览器开发者工具
2. 进行搜索
3. 检查网络请求时间

**预期结果：**
- 搜索API响应时间 < 500ms
- 快速搜索响应时间 < 200ms
- 页面渲染时间 < 1s

#### 5.2 缓存效果
**测试步骤：**
1. 进行相同搜索两次
2. 检查网络请求

**预期结果：**
- 第二次搜索更快
- 缓存命中时减少服务器请求
- 缓存过期后重新请求

#### 5.3 大量结果处理
**测试步骤：**
1. 搜索一个通用词（如 "动画"）
2. 检查页面性能

**预期结果：**
- 页面保持响应
- 分页正常工作
- 内存使用合理

### 6. 用户体验测试

#### 6.1 移动端适配
**测试步骤：**
1. 在移动设备上访问搜索页面
2. 进行搜索操作
3. 检查界面适配

**预期结果：**
- 搜索框大小适中
- 结果列表易于浏览
- 筛选器在移动端可用

#### 6.2 键盘导航
**测试步骤：**
1. 使用Tab键导航搜索界面
2. 使用回车键执行搜索
3. 使用方向键选择建议

**预期结果：**
- 所有交互元素可通过键盘访问
- 焦点指示清晰
- 键盘快捷键正常工作

#### 6.3 无障碍性
**测试步骤：**
1. 使用屏幕阅读器测试
2. 检查ARIA标签
3. 验证颜色对比度

**预期结果：**
- 屏幕阅读器能正确读取内容
- 搜索状态有语音反馈
- 颜色对比度符合WCAG标准

### 7. 错误处理测试

#### 7.1 网络错误
**测试步骤：**
1. 断开网络连接
2. 尝试搜索
3. 恢复网络连接

**预期结果：**
- 显示友好的错误信息
- 提供重试选项
- 网络恢复后自动重试

#### 7.2 无结果处理
**测试步骤：**
1. 搜索一个不存在的内容
2. 检查无结果页面

**预期结果：**
- 显示"无搜索结果"信息
- 提供搜索建议
- 建议修改搜索词

#### 7.3 特殊字符处理
**测试用例：**
- 特殊符号：`@#$%^&*()`
- 空格：`   `
- 超长查询：300字符的搜索词

**预期结果：**
- 特殊字符被正确处理
- 空格查询被拒绝或清理
- 超长查询被截断或拒绝

### 8. 安全性测试

#### 8.1 XSS防护
**测试步骤：**
1. 搜索包含HTML标签的内容：`<script>alert('xss')</script>`
2. 检查搜索结果显示

**预期结果：**
- HTML标签被转义
- 不执行恶意脚本
- 搜索高亮安全

#### 8.2 SQL注入防护
**测试步骤：**
1. 搜索SQL注入字符串：`'; DROP TABLE movies; --`
2. 检查应用是否正常

**预期结果：**
- 应用正常运行
- 数据库不受影响
- 查询被安全处理

## 测试数据

### 推荐测试关键词

**电影相关：**
- 千与千寻、龙猫、天空之城
- Spirited Away、My Neighbor Totoro
- 宫崎骏、Hayao Miyazaki

**角色相关：**
- 千寻、龙猫、无脸男
- 小梅、希达、苏菲

**主题相关：**
- 环保、成长、友情
- 魔法、冒险、家庭

**年份相关：**
- 1988、2001、2004
- 1980s、2000s

## 测试报告模板

### 测试执行记录

| 测试项目 | 测试结果 | 问题描述 | 严重程度 | 状态 |
|---------|---------|---------|---------|------|
| 基础搜索 | ✅ 通过 | - | - | 完成 |
| 搜索建议 | ❌ 失败 | 建议加载慢 | 中等 | 待修复 |
| 移动端适配 | ⚠️ 部分通过 | 筛选器显示问题 | 低 | 待优化 |

### 性能指标

| 指标 | 目标值 | 实际值 | 状态 |
|------|-------|-------|------|
| 搜索响应时间 | < 500ms | 320ms | ✅ |
| 缓存命中率 | > 70% | 85% | ✅ |
| 页面加载时间 | < 2s | 1.2s | ✅ |

### 问题跟踪

**高优先级问题：**
1. [问题描述]
2. [复现步骤]
3. [预期行为]
4. [实际行为]

**改进建议：**
1. [建议内容]
2. [预期效果]
3. [实现难度]

## 总结

通过系统性的测试，确保搜索功能在各种场景下都能正常工作，为用户提供优秀的搜索体验。定期执行这些测试用例，及时发现和修复问题，持续优化搜索功能的性能和用户体验。
